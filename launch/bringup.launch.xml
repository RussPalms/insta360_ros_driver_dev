<?xml version="1.0"?>
<launch>
    <arg name="equirectangular" default="true"/>
    <arg name="imu_filter" default="true"/>
    <arg name="equirectangular_config" default="$(find-pkg-share insta360_ros_driver)/config/equirectangular.yaml"/>
    <arg name="imu_config" default="$(find-pkg-share insta360_ros_driver)/config/imu_filter.yaml"/>

    <!-- Publishes Compressed Images -->
    <node pkg="insta360_ros_driver" exec="insta360_ros_driver" name="insta360_ros_driver" output="log"/>

    <!-- Decodes Compressed Images -->
    <node pkg="insta360_ros_driver" exec="decoder" name="image_decoder" output="log">
        <param name="compressed_topic" value="/dual_fisheye/image/compressed"/>
        <param name="uncompressed_topic" value="/dual_fisheye/image"/>
        <!-- We can skip decoding every <skip_frame>. So skip_frame = 1 will only publish half the frames, etc. -->
        <param name="skip_frame" value="0"/>
        <!-- If you want to minimize the CPU load the most, you can decode only the i-frames. But the expected FPS is about 1-2 FPS -->
        <param name="i_frame_only" value="false"/> 
    </node>

    <!-- Creates Equirectangular Images -->
    <node if="$(var equirectangular)" pkg="insta360_ros_driver" exec="equirectangular_cpp" name="equirectangular_node" output="screen">
        <param from="$(var equirectangular_config)" />
    </node>

    <!-- Applies a Madgwick Filter to the 6-DOF IMU to get Orientation -->
    <node if="$(var imu_filter)" pkg="imu_filter_madgwick" exec="imu_filter_madgwick_node" name="imu_filter" output="log">
        <param from="$(var imu_config)"/>
    </node>
</launch>